# Issue優先順位ロードマップ

**ターゲット**: 個人利用MVP、最小限実装\
**作成日**: 2025-08-22\
**更新日**: 2025-10-06 (最新状況: #173 完了 -
スクレイピング並行実行時のBrowserManager共有による競合問題)\
**目標**: ✅ 2025-09-30までにMVPローンチ (**完了**: 2025-09-16)

## 実装状況サマリー

- **MVP完成**: 🎉 **全必須機能実装完了** (2025-09-16)
  - 基盤構築、外部サービス統合、スクレイピング、通知システム、CI/CD、本番環境構築すべて完了
  - Production deployment verification完了、システム正常稼働中
- **現在**: Post-MVP改善・機能拡張フェーズ
- **運用状況**: 自動チケット監視・LINE通知が稼働中

## 実装フェーズ概要

### Phase 1: 基盤構築（3日間）

**目的**: 最小限の開発環境構築

| Issue | タイトル                                          | 優先度      | ステータス       | 理由                         |
| ----- | ------------------------------------------------- | ----------- | ---------------- | ---------------------------- |
| #28   | Google Cloud Platformプロジェクト・アカウント設定 | 🔴 Critical | ✅ **COMPLETED** | 全GCPサービスの前提条件      |
| #29   | LINE Bot外部サービス設定                          | 🔴 Critical | ✅ **COMPLETED** | 通知機能の前提条件           |
| #17   | 環境変数と基本シークレット設定                    | 🔴 Critical | ✅ **COMPLETED** | 簡素化されたセキュリティ基盤 |
| #36   | 基本型定義とエンティティ                          | 🔴 Critical | ✅ **COMPLETED** | コアドメインモデル           |
| #37   | Supabaseクライアントとリポジトリ                  | 🔴 Critical | ✅ **COMPLETED** | データ永続化層               |
| #39   | 最小限のセキュリティ設定                          | 🔴 Critical | ✅ **COMPLETED** | 基本セキュリティ要件         |
| #40   | 初期データベーススキーマ作成                      | 🔴 Critical | ✅ **COMPLETED** | データベース構造             |

### Phase 2: コア機能実装（4日間） - **更新**

**目的**: スクレイピング、データ整合性、スケジューリング機能の実装

| Issue | タイトル                                                 | 優先度      | ステータス       | 理由                            |
| ----- | -------------------------------------------------------- | ----------- | ---------------- | ------------------------------- |
| #38   | Playwrightスクレイピング実装                             | 🔴 Critical | ✅ **COMPLETED** | コアデータ取得機能              |
| #12   | チケット管理アプリケーションサービス実装                 | 🔴 Critical | ✅ **COMPLETED** | コアビジネスロジック            |
| #24   | Google Cloud Runスクレイピングサービス実装               | 🔴 Critical | ✅ **COMPLETED** | コンテナデプロイ                |
| #61   | **チケット重複処理・UPSERT機能実装** (**NEW**)           | 🔴 Critical | ✅ **COMPLETED** | **#25の前提条件・重複防止**     |
| #62   | **発売済みチケット状態管理・除外機能実装** (**NEW**)     | 🔴 Critical | ✅ **COMPLETED** | **#25の前提条件・無駄処理防止** |
| #25   | Google Cloud Tasks通知スケジューリング実装               | 🔴 Critical | ✅ **COMPLETED** | 通知タイミング制御              |
| #78   | **Cloud Tasks→Cloud Run LINE通知統合完全実装** (**NEW**) | 🔴 Critical | ✅ **COMPLETED** | **#25統合完了・MVP必須**        |
| #26   | Cloud Scheduler日次実行設定実装                          | 🔴 Critical | ✅ **COMPLETED** | 自動化要件                      |

### Phase 3: 通知サービス（2日間）

**目的**: 通知配信の実装

| Issue | タイトル                             | 優先度      | ステータス       | 理由                     |
| ----- | ------------------------------------ | ----------- | ---------------- | ------------------------ |
| #27   | LINE通知サービス実装                 | 🔴 Critical | ✅ **COMPLETED** | メイン通知チャネル       |
| #64   | Cloud Loggingによるデータ品質監視    | 🟠 High     | ✅ **COMPLETED** | GCP経由のエラー監視      |
| #13   | 通知管理アプリケーションサービス実装 | 🔴 Critical | ✅ **COMPLETED** | 通知オーケストレーション |

### Phase 4: デプロイ（3日間） - **更新**

**目的**: 本番環境デプロイと自動CI/CD

| Issue | タイトル                                         | 優先度      | ステータス       | 理由                         |
| ----- | ------------------------------------------------ | ----------- | ---------------- | ---------------------------- |
| #33   | **GitHub Actions CI/CDパイプライン実装**         | 🔴 Critical | ✅ **COMPLETED** | **MVP自動デプロイ必須**      |
| #82   | **GCP本番環境構築・Service Account設定**         | 🔴 Critical | ✅ **COMPLETED** | **MVP認証・権限設定必須**    |
| #97   | **GitHub ActionsにSupabaseマイグレーション追加** | 🟠 High     | ✅ **COMPLETED** | **DBマイグレーション自動化** |
| #83   | **Production Deployment Verification**           | 🔴 Critical | ✅ **COMPLETED** | **MVP動作確認完了**          |

## 完了済みIssue（追加実装）

- **#9** - J-Leagueチケットサイトウェブスクレイピングサービス ✅
- **#10** - LINE Messaging API通知サービス ✅
- **#11** - Discord Webhookシステム監視 ✅
- **#14** - 日次チケットスクレイピング実装 ✅
- **#15** - 通知配信実装 ✅
- **#16** - システムヘルス監視実装 ✅
- **#18** - エンドツーエンド統合テストスイート ✅
- **#21** - アーキテクチャドキュメント更新 ✅
- **#22** - 外部スクレイピング環境実装 ✅
- **#31** - 通知サービス統合 ✅
- **#32** - データベースマイグレーション管理 ✅
- **#34** - セキュリティ・権限詳細設計 ✅
- **#27** - LINE APIエンドポイント設定統一化（2025-08-27品質改善） ✅
- **#70** - リポジトリレイヤーからビジネスロジックを分離し、Impl命名規則を統一 ✅
- **#24** - Google Cloud Runスクレイピングサービス実装 ✅
- **#64** - Cloud Loggingによるデータ品質監視 ✅
- **#62** - 発売済みチケット状態管理・除外機能実装 ✅
- **#75** - 依存性注入（DI）パターン導入による単体テストの改善 ✅
- **#73** - NotificationStatusを'pending'から'scheduled'に変更 ✅
- **#78** - Cloud Tasks→Cloud Run LINE通知統合完全実装 ✅
- **#85** - スクレイピングデータ品質向上・日時精度改善実装 ✅
- **#33** - GitHub Actions CI/CDパイプライン実装 ✅
- **#82** - GCP本番環境構築・Service Account設定 ✅
- **#108** - チケット収集成功時の詳細ログ出力改善 ✅
- **#107** - match_dateタイムゾーンバグ修正（HOTFIX）✅
- **#104** - parseMatchDate関数JSTバグ修正（HOTFIX）✅
- **#97** - GitHub ActionsにSupabaseマイグレーション自動実行を追加 ✅
- **#83** - Production Deployment Verification ✅
- **#72** - データベースへのクエリ回数を最適化する（N+1問題解決）✅

## 開発進行ルール

### 1. シンプルに保つ

- 個人利用向け最小限実装
- ステージング環境なし
- 本番環境への直接デプロイ
- 手動テスト許容

### 2. ブランチ戦略

- **パターン**: `feature/#<issue-number>_<description>`
- **例**: `feature/#36_basic-types`

### 3. 完了条件

各issueは以下の条件を満たした時点で完了：

- [ ] 機能が動作する
- [ ] `deno check`が通る
- [ ] 手動テストが通る

## マイルストーン

### 🎉 MVPローンチ ✅ **完了** (2025-09-16)

- **✅ 達成**: Google Cloud統合・本番環境デプロイ完了
- **✅ 成功基準**: 自動チケット監視・LINE通知システム稼働中
- **✅ 実績**: 目標より14日早期完成

### 📈 Post-MVPフェーズ (2025-09-17 ~)

- **ターゲット**: 通知機能強化・セキュリティ向上・運用最適化
- **優先度**: ユーザビリティ改善・システム安定性向上

## 現在の状況 (2025-09-19) - **Post-MVP改善フェーズ**

### ✅ MVP完成 - 完了済みIssue: 62+ (MVP全機能実装済み)

**基盤・インフラ:**

- #28 - Google Cloud Platformプロジェクト設定
- #29 - LINE BotとDiscord Webhook外部設定
- #17 - 環境変数と基本シークレット設定
- #36 - 基本型定義とエンティティ
- #37 - Supabaseクライアントとリポジトリ
- #39 - 最小限のセキュリティ設定
- #40 - 初期データベーススキーマ作成

**コアサービス:**

- #9 - J-Leagueチケットサイトウェブスクレイピングサービス
- #10 - LINE Messaging API通知サービス
- #11 - Discord Webhookシステム監視
- #14 - 日次チケットスクレイピング実装
- #15 - 通知配信実装
- #16 - システムヘルス監視実装
- #27 - LINE通知サービス実装
- #12 - チケット管理アプリケーションサービス実装
- #38 - Playwrightスクレイピング実装
- #13 - 通知管理アプリケーションサービス実装
- #61 - チケット重複処理・UPSERT機能実装
- #70 - リポジトリレイヤーからビジネスロジックを分離し、Impl命名規則を統一
- #25 - Google Cloud Tasks通知スケジューリング実装
- #75 - 依存性注入（DI）パターン導入による単体テストの改善
- #73 - Notification status名称変更 (pending → scheduled)
- #24 - Google Cloud Runスクレイピングサービス実装
- #64 - Cloud Loggingによるデータ品質監視
- #62 - 発売済みチケット状態管理・除外機能実装
- #78 - Cloud Tasks→Cloud Run LINE通知統合完全実装
- #26 - Cloud Scheduler日次実行設定実装
- #85 - スクレイピングデータ品質向上・日時精度改善実装

**テスト・ドキュメント:**

- #18 - エンドツーエンド統合テストスイート
- #21 - アーキテクチャドキュメント更新
- #22 - 外部スクレイピング環境実装
- #31 - 通知サービス統合
- #32 - データベースマイグレーション管理
- #34 - セキュリティ・権限詳細設計

**本番環境デプロイ:**

- #33 - GitHub Actions CI/CDパイプライン実装
- #82 - GCP本番環境構築・Service Account設定
- #49 - Supabase無料枠自動停止対策：毎日のヘルスチェック記録実装
- #51 - アーキテクチャ改善: servicesをinfrastructureからapplicationレイヤーに移動
- #53 - LINE通知をグループ配信からブロードキャスト配信に変更

### 🎉 **MVP完了** (2025-09-16)

**🚀 システム稼働状況**:

- ✅ 自動チケット監視システム稼働中
- ✅ LINE通知配信機能稼働中
- ✅ Cloud Run + Cloud Scheduler自動実行
- ✅ CI/CD自動デプロイ機能稼働中
- ✅ エラー監視・Cloud Logging稼働中

### 🔧 **最近の追加実装** (2025-09-15～17):

- #112 - 本番環境でCloud Tasks→LINE通知の全フローテスト実装 ✅
- #108 - チケット収集成功時の詳細ログ出力改善 ✅
- #107 - match_dateタイムゾーンバグ修正（HOTFIX）✅
- #104 - parseMatchDate関数JSTバグ修正（HOTFIX）✅
- #100 - チケット情報取得・LINE用フォーマット機能実装 ✅
- #99 - Cloud RunにLINE Webhookエンドポイント実装 ✅
- #97 - GitHub ActionsにSupabaseマイグレーション追加 ✅
- #83 - Production Deployment Verification ✅
- #82 - GCP本番環境構築・Service Account設定 ✅
- #80 - Cloud Run APIエンドポイントのセキュリティ強化 ✅
- #64 - スクレイピングデータ品質監視・Discord通知機能 ✅

### 📈 **現在の開発フェーズ**: Post-MVP改善・機能拡張

### ✅ **最近完了・クローズしたIssue (2025-10-06)**:

- #173 - スクレイピング並行実行時のBrowserManager共有による競合問題 ✅ **NEW**
- #168 - 開発環境でのwatch機能とプロダクション環境でのテストモード機能の両立実装 ✅
- #161 - スクレイピング更新時のnotification_scheduledフィールド上書き問題を修正 ✅
- #160 - チケット更新時の差分ログ出力機能を実装 ✅
- #158 - エラーログ自動通知システムの実装 ✅
- #157 - 不要なPostgreSQL functionsとcron jobsを削除してアーキテクチャを統一 ✅
- #155 - SendTicketSummaryUseCaseのクリーンアーキテクチャ違反を修正：Application層Service導入 ✅
- #152 - YAGNI: 未使用コードとエンドポイントの削除 ✅
- #150 - インフラ層のスクレイピング関連ディレクトリ構造を統合 ✅
- #149 - 広島スクレイパーの複数の問題：エラーハンドリング、SaleStatusUtils未使用、会場警告 ✅
- #140 - Cloud Scheduler月次実行を月初20時に変更 ✅
- #137 - 通知システムの改善: sent_atの誤更新修正とupdated_at追加 ✅
- #135 - notificationsテーブルの命名不整合を修正 ✅
- #131 - LINEメッセージの試合日時と販売開始日時をJST表示に修正 ✅
- #130 - PostgreSQL セキュリティパッチ適用のためのデータベースアップグレード ✅
- #129 - notificationsテーブルのnotification_scheduledカラム冗長性解決 ✅
- #101 - 月初チケット一覧送信機能実装（Cloud Scheduler + LINE通知）✅

## 🚨 アクティブIssue - 優先順位別

### 🔴 **高優先度 - 機能拡張・改善**

| Issue | タイトル                                | カテゴリ         | 優先度  | ステータス  |
| ----- | --------------------------------------- | ---------------- | ------- | ----------- |
| #171  | 開発環境でのCloudTasksモック実装        | 開発効率改善     | 🟠 High | 🚨 **OPEN** |
| #172  | ドキュメント構造の整理とREADME.md最適化 | ドキュメント改善 | 🟡 Med  | 🚨 **OPEN** |

### ✅ **完了 - 技術的負債・バグ修正**

| Issue | タイトル                                                                             | 理由                                           | ステータス       |
| ----- | ------------------------------------------------------------------------------------ | ---------------------------------------------- | ---------------- |
| #173  | スクレイピング並行実行時のBrowserManager共有による競合問題                           | **並行処理バグ・システム安定性向上**           | ✅ **COMPLETED** |
| #155  | SendTicketSummaryUseCaseのクリーンアーキテクチャ違反を修正：Application層Service導入 | **クリーンアーキテクチャ原則違反の修正**       | ✅ **COMPLETED** |
| #152  | YAGNI: 未使用コードとエンドポイントの削除                                            | コード品質向上・メンテナンス性改善             | ✅ **COMPLETED** |
| #150  | インフラ層のスクレイピング関連ディレクトリ構造を統合                                 | アーキテクチャ整理・構造統一                   | ✅ **COMPLETED** |
| #149  | 広島スクレイパーの複数の問題：エラーハンドリング、SaleStatusUtils未使用、会場警告    | **システム停止リスク・ドメインロジック不整合** | ✅ **COMPLETED** |
| #125  | 日時ライブラリ導入によるタイムゾーン処理の改善                                       | タイムゾーンバグの根本解決                     | ✅ **COMPLETED** |
| #126  | 通知スケジュール管理の不整合とカラム名改善                                           | データ整合性の改善                             | ✅ **COMPLETED** |
| #131  | LINEメッセージの試合日時と販売開始日時をJST表示に修正                                | ユーザビリティ改善                             | ✅ **COMPLETED** |
| #135  | notificationsテーブルの命名不整合を修正                                              | データベース設計改善                           | ✅ **COMPLETED** |
| #137  | 通知システムの改善: sent_atの誤更新修正とupdated_at追加                              | データ整合性向上                               | ✅ **COMPLETED** |
| #130  | PostgreSQL セキュリティパッチ適用のためのデータベースアップグレード                  | セキュリティ維持                               | ✅ **COMPLETED** |
| #129  | notificationsテーブルのnotification_scheduledカラム冗長性解決とスキーマ整合性修正    | データベース設計改善                           | ✅ **COMPLETED** |
| #157  | 不要なPostgreSQL functionsとcron jobsを削除してアーキテクチャを統一                  | アーキテクチャ統一・リファクタリング           | ✅ **COMPLETED** |

### 🟡 **中優先度 - 運用最適化** (Phase 5)

| Issue | タイトル                                               | カテゴリ       | ステータス  |
| ----- | ------------------------------------------------------ | -------------- | ----------- |
| #86   | スクレイピング最適化検討：サイト負荷軽減を優先した改善 | パフォーマンス | 🚨 **OPEN** |
| #68   | データベース履歴とGCPログの料金最適化                  | コスト削減     | 🚨 **OPEN** |
| #84   | Playwright scraperのmock化対応                         | テスト改善     | 🚨 **OPEN** |
| #176  | Ticketエンティティのoptionalプロパティをnullに統一     | リファクタ     | 🚨 **OPEN** |

### 🟢 **低優先度 - 機能拡張・運用改善**

| Issue | タイトル                                            | カテゴリ        | ステータス                        |
| ----- | --------------------------------------------------- | --------------- | --------------------------------- |
| #177  | スクレイパー間でのログ出力戦略の一貫性を確保        | コード品質改善  | 🚨 **OPEN**                       |
| #165  | createdAt/updatedAtの管理をデータベース側に移行する | Phase 5運用改善 | 🚨 **OPEN**                       |
| #164  | Ticketエンティティのデフォルト値設定を一元化する    | コード品質改善  | 🚨 **OPEN**                       |
| #67   | ヴィッセル神戸対応                                  | 他チーム対応    | 🔄 **DEFERRED** (2026年1-2月実装) |
| #105  | 2026年シーズン制度変更対応                          | 長期計画        | 🔄 **DEFERRED** (2026年2月まで)   |

## 次のステップ優先順位 (**更新: 2025-10-06**)

### 🎯 **推奨実装順序**

#### 📍 **高優先タスク** (開発効率改善)

1. **#171** - 開発環境でのCloudTasksモック実装 🟠 **高優先度**
   - **内容**: ローカル開発環境でのCloud Tasksモック機能実装
   - **期待効果**: 開発効率改善・テスト環境統一

#### 📍 **中優先タスク** (ドキュメント整理・運用改善)

2. **#172** - ドキュメント構造の整理とREADME.md最適化 🟡
   - **内容**: プロジェクトドキュメント構造の整理とREADME改善
   - **期待効果**: プロジェクト理解しやすさ向上・メンテナンス性改善

3. **#86** - スクレイピング最適化 🟡
   - **内容**: サイト負荷軽減を優先した詳細ページアクセス改善
   - **期待効果**: 安定性向上・サイト負荷軽減

4. **#68** - GCPログ料金最適化 🟡
   - **内容**: 古いログ・履歴データの自動削除設定
   - **期待効果**: 運用コスト削減

5. **#176** - Ticketエンティティのoptionalプロパティをnullに統一 🟡
   - **内容**: オブジェクト比較の安定性向上のためnull統一
   - **期待効果**: コード品質向上・バグ防止

#### 📍 **将来対応** (長期計画・来年以降)

6. **#177** - スクレイパー間でのログ出力戦略の一貫性を確保 🟢
   - **内容**: ログフォーマット統一・出力レベル調整
   - **期待効果**: 保守性向上・デバッグ効率改善
7. **#67** - ヴィッセル神戸対応 🟢
   - **延期理由**: 現在販売中チケットのみで販売前DOMパターンが不明
   - **実装時期**: 2026年1-2月（新規チケット販売開始時）
8. **#84** - Playwright scraper mock化 🟡
9. **#105** - 2026年シーズン制度変更対応 🟢 (2026年2月まで)

## Issueラベル管理戦略

### 🏷️ **推奨ラベル体系**

**優先度ラベル**:

- `priority/critical` - システム停止・セキュリティ問題
- `priority/high` - 機能改善・パフォーマンス向上
- `priority/medium` - 運用最適化・コスト削減
- `priority/low` - 将来機能・長期計画

**実装時期ラベル**:

- `immediate` - 即座に実装可能
- `deferred/2026-q1` - 2026年1-2月実装予定
- `deferred/long-term` - 長期計画

**カテゴリラベル**:

- `enhancement` - 機能拡張
- `performance` - パフォーマンス改善
- `cost-optimization` - コスト最適化
- `testing` - テスト改善

### 🎯 **現在のissueラベル適用推奨**

| Issue | 推奨ラベル                                          |
| ----- | --------------------------------------------------- |
| #158  | `priority/high`, `enhancement`, `immediate`         |
| #72   | `priority/high`, `performance`, `immediate`         |
| #68   | `priority/medium`, `cost-optimization`, `immediate` |
| #86   | `priority/medium`, `performance`, `immediate`       |
| #84   | `priority/medium`, `testing`, `immediate`           |
| #67   | `priority/low`, `enhancement`, `deferred/2026-q1`   |
| #105  | `priority/low`, `enhancement`, `deferred/long-term` |

## 進捗確認

```bash
# 優先度別の進捗確認
gh issue list --label "priority/critical" --state "open"
gh issue list --label "priority/high" --state "open"
gh issue list --label "priority/medium" --state "open"

# 実装時期別の進捗確認
gh issue list --label "immediate" --state "open"
gh issue list --label "deferred/2026-q1" --state "open"

# 全体の進捗確認
gh issue list --state "open"
```
