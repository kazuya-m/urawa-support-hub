# urawa-support-hub Claude Code é–‹ç™ºãƒ¡ãƒ¢

# Role (Claudeã®å½¹å‰²)
- ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã¨ã—ã¦æŒ¯ã‚‹èˆã„ã¾ã™
- è‚¯å®šã‚’ç›®çš„ã¨ã›ãšã€æ‰¹åˆ¤çš„ã‹ã¤å»ºè¨­çš„ãªè¦–ç‚¹ã§åˆ†æã—ã¾ã™
- ç†è§£åº¦ãŒ100%ã«é”ã—ã¦ã„ãªã„å ´åˆã€ãã®ã¾ã¾å®Ÿè£…ã‚’é€²ã‚ã‚‹ã®ã§ã¯ãªãã€è³ªå•ã‚’è¿”ã—ã¦ç†è§£ã‚’æ·±ã‚ã‚‹ã“ã¨
- ç†è§£åº¦ãŒ100%ã«é”ã—ã¦ã„ãªã„å ´åˆã€ãã®æ™‚ç‚¹ã§ã®ç†è§£åº¦ã‚’ç¤ºã—ãŸä¸Šã§å®Ÿè£…ã®å†…å®¹ã‚’èª¬æ˜ã™ã‚‹ã“ã¨

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
æµ¦å’Œãƒ¬ãƒƒã‚ºã‚µãƒãƒ¼ã‚¿ãƒ¼å‘ã‘ã‚¢ã‚¦ã‚§ã‚¤æˆ¦ãƒã‚±ãƒƒãƒˆè²©å£²æƒ…å ±è‡ªå‹•é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 

## é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥
- `main`: æœ¬ç•ªç’°å¢ƒç”¨ã®å®‰å®šãƒ–ãƒ©ãƒ³ãƒ
- `feature/*`: æ©Ÿèƒ½é–‹ç™ºç”¨ãƒ–ãƒ©ãƒ³ãƒï¼ˆä¾‹: `feature/implement-ticket-repository`ï¼‰
- `fix/*`: ãƒã‚°ä¿®æ­£ç”¨ãƒ–ãƒ©ãƒ³ãƒ

### ã‚³ãƒŸãƒƒãƒˆç²’åº¦ã¨ãƒ–ãƒ©ãƒ³ãƒé‹ç”¨
**é‡è¦**: æ©Ÿèƒ½å˜ä½ã§é©åˆ‡ã«ãƒ–ãƒ©ãƒ³ãƒã‚’åˆ‡ã‚Šã€å°ã•ãªå˜ä½ã§ã‚³ãƒŸãƒƒãƒˆã™ã‚‹ã“ã¨

#### æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³:
1. **æ©Ÿèƒ½å®Ÿè£…æ™‚**: å„æ©Ÿèƒ½ã”ã¨ã«æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
   ```bash
   git checkout -b feature/implement-basic-types
   # å‹å®šç¾©å®Ÿè£…
   git add . && git commit -m "add basic types for Ticket and NotificationHistory"
   
   git checkout -b feature/implement-ticket-repository
   # ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…
   git add . && git commit -m "implement TicketRepository interface and Supabase implementation"
   ```

2. **ã‚³ãƒŸãƒƒãƒˆå˜ä½**: 1ã¤ã®è«–ç†çš„å¤‰æ›´ã«ã¤ã1ã‚³ãƒŸãƒƒãƒˆ
   - âœ… Good: "add Ticket type definition"
   - âœ… Good: "implement SupabaseTicketRepository save method"
   - âŒ Bad: "implement everything for ticket management"

3. **ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**: æ©Ÿèƒ½å®Œæˆå¾Œã«mainã¾ãŸã¯developã«ãƒãƒ¼ã‚¸

### ç¾åœ¨ã®å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º
Phase 1: åŸºç›¤æ§‹ç¯‰ã¨ã‚³ã‚¢æ©Ÿèƒ½å®Ÿè£…

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
1. åŸºç›¤æ§‹ç¯‰ (ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã€Denoè¨­å®š)
2. SupabaseåˆæœŸåŒ– (DB ã‚¹ã‚­ãƒ¼ãƒ)
3. å‹å®šç¾©ä½œæˆ
4. ãƒªãƒã‚¸ãƒˆãƒªå±¤å®Ÿè£…
5. é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…
6. ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°æ©Ÿèƒ½å®Ÿè£…
7. Edge Functionså®Ÿè£…
8. ãƒ†ã‚¹ãƒˆå®Ÿè£…

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- Runtime: Deno + TypeScript
- Database: Supabase PostgreSQL
- Functions: Supabase Edge Functions
- Scraping: Playwright
- Notifications: LINE Messaging API + Discord Webhook
- Scheduler: pg_cron

### ç’°å¢ƒè¨­å®šçŠ¶æ³
- LINE Messaging API: âœ… è¨­å®šå®Œäº†
- Discord Webhook: æœªè¨­å®š
- Supabase: æœªåˆæœŸåŒ–

### é‡è¦ãªåˆ¶ç´„äº‹é …
- ãƒ¡ãƒ¢ãƒªåˆ¶é™: 512MB (Edge Functions)
- å®Ÿè¡Œæ™‚é–“åˆ¶é™: 60ç§’
- ç„¡æ–™æ å†…ã§ã®é‹ç”¨å¿…é ˆ

## é–‹ç™ºæ™‚ã®æ³¨æ„ç‚¹
- å®Ÿè£…å‰ã«å¿…ãšJãƒªãƒ¼ã‚°ãƒã‚±ãƒƒãƒˆã‚µã‚¤ãƒˆã®æ§‹é€ ã‚’èª¿æŸ»
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å„æ©Ÿèƒ½ã«å¿…ãšå®Ÿè£…
- ãƒ­ã‚°å‡ºåŠ›ã§ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’é©åˆ‡ã«è¨˜éŒ²
- ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã‚’å¿ƒãŒã‘ã‚‹

## å¿…é ˆé–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹
### ğŸš¨ å®Ÿè£…å¾Œã¯å¿…ãšå‹•ä½œç¢ºèªã¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚’è¡Œã†ã“ã¨

#### 1. å‹•ä½œç¢ºèªã®æ‰‹é †
- **TypeScriptå‹ãƒã‚§ãƒƒã‚¯**: `deno check` ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª
- **Lintãƒã‚§ãƒƒã‚¯**: `deno lint` ã§ã‚³ãƒ¼ãƒ‰å“è³ªã‚’ç¢ºèª
- **ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®å®Ÿè¡Œãƒ†ã‚¹ãƒˆ**: å®Ÿè£…ã—ãŸæ©Ÿèƒ½ãŒæœŸå¾…é€šã‚Šå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æºç¢ºèª**: Supabaseã¨ã®æ¥ç¶šã€CRUDæ“ä½œã®å‹•ä½œç¢ºèª
- **åˆ¶ç´„ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºèª**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ¶ç´„ã€å‹ãƒã‚§ãƒƒã‚¯ã®å‹•ä½œç¢ºèª
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ç¢ºèª**: ç•°å¸¸ç³»ã®ã‚±ãƒ¼ã‚¹ã§ã‚¨ãƒ©ãƒ¼ãŒé©åˆ‡ã«å‡¦ç†ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

#### 2. ãƒ†ã‚¹ãƒˆå®Ÿè£…ã®ç¾©å‹™

##### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«é…ç½®ãƒ«ãƒ¼ãƒ«
- **é…ç½®å ´æ‰€**: å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒéšå±¤ã«`__tests__`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€ãã®ä¸­ã«ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®
- **ãƒ•ã‚¡ã‚¤ãƒ«å‘½å**: `å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«å.test.ts`å½¢å¼ã§å‘½å
- **ä¾‹**: `src/features/repositories/TicketRepository.ts` â†’ `src/features/repositories/__tests__/TicketRepository.test.ts`

##### ãƒ†ã‚¹ãƒˆå®Ÿè£…è¦ä»¶
- **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ**: å„é–¢æ•°ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ã®å˜ä½“å‹•ä½œã‚’ç¢ºèªã™ã‚‹ãƒ†ã‚¹ãƒˆ (å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒéšå±¤ã®`__tests__/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª)
- **çµ±åˆãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ**: ä¸»è¦æ©Ÿèƒ½ã®å‹•ä½œã‚’ç¢ºèªã™ã‚‹å®Ÿè¡Œå¯èƒ½ãªãƒ†ã‚¹ãƒˆ (`tests/integration/`)
- **å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã§ã®ãƒ†ã‚¹ãƒˆ**: ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã§ã¯ãªãå®Ÿéš›ã®åˆ¶ç´„ã«åˆã†ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½¿ç”¨
- **å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆ**: æ­£å¸¸ç³»ãƒ»ç•°å¸¸ç³»ãƒ»å¢ƒç•Œå€¤ã§ã®å‹•ä½œç¢ºèª
- **ãƒ¢ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ**: å¤–éƒ¨ä¾å­˜é–¢ä¿‚ã‚’ãƒ¢ãƒƒã‚¯åŒ–ã—ãŸå˜ä½“ãƒ†ã‚¹ãƒˆ
- **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†**: ãƒ†ã‚¹ãƒˆå¾Œã®ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã‚’å«ã‚€å®Œå…¨ãªãƒ†ã‚¹ãƒˆ
- **ãƒ†ã‚¹ãƒˆçµæœã®æ¤œè¨¼**: å…¨ã¦ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒæˆåŠŸã™ã‚‹ã“ã¨ã‚’ç¢ºèª

#### 3. ã‚³ãƒŸãƒƒãƒˆå‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ ] `deno check` å‹ãƒã‚§ãƒƒã‚¯æˆåŠŸç¢ºèªæ¸ˆã¿
- [ ] `deno lint` Lintãƒã‚§ãƒƒã‚¯æˆåŠŸç¢ºèªæ¸ˆã¿
- [ ] **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆæ¸ˆã¿** (å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒéšå±¤ã®`__tests__/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª)
- [ ] **çµ±åˆãƒ†ã‚¹ãƒˆä½œæˆæ¸ˆã¿** (tests/integration/)
- [ ] `deno test --allow-all` å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸç¢ºèªæ¸ˆã¿
- [ ] å‹•ä½œç¢ºèªãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ¸ˆã¿
- [ ] ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ãƒ»å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ¸ˆã¿
- [ ] ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ç¢ºèªæ¸ˆã¿

**é‡è¦**: å‹•ä½œç¢ºèªãªã—ã§ã®ã‚³ãƒŸãƒƒãƒˆãƒ»PRã¯ç¦æ­¢ã€‚å¿…ãšãƒ†ã‚¹ãƒˆã‚’é€šã—ã¦ã‹ã‚‰æ¬¡ã®å·¥ç¨‹ã«é€²ã‚€ã“ã¨ã€‚

## è¨­è¨ˆåŸå‰‡ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ğŸ¯ å¿…é ˆéµå®ˆäº‹é …

#### 1. å‘½åè¦å‰‡
```typescript
// âœ… Good: æŠ€è¡“éä¾å­˜
export class TicketRepositoryImpl implements TicketRepository

// âŒ Bad: å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ä¾å­˜
export class SupabaseTicketRepository implements TicketRepository
```

#### 2. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°çµ±ä¸€
```typescript
// âœ… å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’ä½¿ç”¨
if (error) handleSupabaseError('save ticket', error);

// âŒ é‡è¤‡ã‚³ãƒ¼ãƒ‰
if (error) throw new Error(`Failed to save ticket: ${error.message}`);
```

#### 3. ãƒ†ã‚¹ãƒˆè¨­è¨ˆ
- **åˆ†å‰²**: å€‹åˆ¥ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆï¼ˆå·¨å¤§çµ±åˆãƒ†ã‚¹ãƒˆç¦æ­¢ï¼‰
- **å…±é€šåŒ–**: `createTestSupabaseClient()`, `cleanupTestData()` æ´»ç”¨
- **æ¨©é™**: `--allow-env --allow-net=127.0.0.1` ï¼ˆ`--allow-all` ç¦æ­¢ï¼‰

#### 4. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
```
src/features/
â”œâ”€â”€ shared/repositories/  # ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”œâ”€â”€ shared/utils/        # å…±é€šå‡¦ç†
â””â”€â”€ {feature}/repositories/{Entity}RepositoryImpl.ts
```

### ğŸš¨ ç¦æ­¢äº‹é …
- å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹åã‚’ã‚¯ãƒ©ã‚¹åã«å«ã‚ã‚‹
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®é‡è¤‡
- `--allow-all` æ¨©é™ä½¿ç”¨
- å·¨å¤§ãªçµ±åˆãƒ†ã‚¹ãƒˆ

### ğŸ¯ æ¬¡å›ã‚»ãƒƒã‚·ãƒ§ãƒ³æ™‚ãƒã‚§ãƒƒã‚¯é …ç›®
- [ ] `{Entity}RepositoryImpl` å‘½åä½¿ç”¨
- [ ] å…±é€šã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼æ´»ç”¨
- [ ] æœ€å°æ¨©é™è¨­å®š
- [ ] æ—¢å­˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã®ä¸€è²«æ€§ç¢ºèª

## è¨­å®šé§†å‹•è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

### ğŸ¯ NotificationConfig è¨­å®šå¤–éƒ¨åŒ–
é‹ç”¨ä¸­ã®å€¤å¤‰æ›´ã«å¯¾å¿œã™ã‚‹ãŸã‚ã€é€šçŸ¥ã‚¿ã‚¤ãƒŸãƒ³ã‚°è¨­å®šã‚’å®Œå…¨å¤–éƒ¨åŒ–

```typescript
// âœ… è¨­å®šé§†å‹•: NotificationConfig.ts
export const NOTIFICATION_TIMING_CONFIG = {
  day_before: {
    displayName: 'è²©å£²é–‹å§‹å‰æ—¥',
    calculateScheduledTime: (saleStartDate: Date): Date => {
      // å‰æ—¥20:00è¨­å®š (å¤‰æ›´æ™‚ã¯ã“ã“ã ã‘ä¿®æ­£)
    },
    toleranceMs: 5 * 60 * 1000
  }
}

// âœ… ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã§ã¯è¨­å®šã‚’å‚ç…§
shouldSendNotification(type: NotificationType, currentTime: Date): boolean {
  return shouldSendNotificationAtTime(type, this.saleStartDate, currentTime);
}
```

#### ãƒ¡ãƒªãƒƒãƒˆ
- **ä¿å®ˆæ€§**: é€šçŸ¥ã‚¿ã‚¤ãƒŸãƒ³ã‚°å¤‰æ›´æ™‚ã¯1ç®‡æ‰€ã ã‘ä¿®æ­£
- **æ‹¡å¼µæ€§**: æ–°ã—ã„é€šçŸ¥ã‚¿ã‚¤ãƒ—ã‚’ç°¡å˜è¿½åŠ å¯èƒ½
- **å‹å®‰å…¨æ€§**: TypeScriptã®å‹ãƒã‚§ãƒƒã‚¯ã§æ•´åˆæ€§æ‹…ä¿

#### é©ç”¨æ¸ˆã¿ç®‡æ‰€
- `src/domain/entities/NotificationConfig.ts`: è¨­å®šå®šç¾©
- `src/domain/entities/Ticket.ts`: ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰å‰Šé™¤ã€è¨­å®šåˆ©ç”¨
- `src/domain/entities/NotificationHistory.ts`: è¡¨ç¤ºåãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³çµ±ä¸€